"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(t,e,s,i){t.strip_tags=function(t){return(t||"").replace(/(<([^>]+)>)/gi,"")};var n={_init:function(e,s){var i=this;this.settings=t.extend({},t.fn.multi_select.defaults,s),this.$el=t(e),this.selectedValues=[],this.basicClass="multi-button",this.selectColors="green blue aqua red yellow maroon purple".split(" ");var n=this.settings;t(e).each(function(){t(this).css({position:"relative",width:n.buttonWidth}),$wrapper=i._styleElement(t(this)),$list=i._createList(t(this)),t(this).append($list),t(this).data("list",$list),i._addEvents(this),i._setSelected()})},init:function(){this._init.call(this,this.$el,this.settings)},_createList:function(e){var s=this,i=s.settings,n=this.getData(),l=i.selectedIndexes,a={};(i=i.listMaxHeight)&&(a={"overflow-x":"hidden","overflow-y":"auto",display:"none","max-height":i});var c=t("<ul />",{class:"multi-menu"}).css(a).data("trigger",e);return e=t("<li />",{class:"control"}),$selAllNone=t("<a />",{class:"select-all-none",text:this.settings.selectAllText}).on("click",function(t){t.preventDefault(),s._selectToggle(this)}),e.append($selAllNone),c.append(e),0<n.length&&t.each(n,function(e,i){var n="";-1!==t.inArray(i.index,l)&&(n="selected"),n=t("<li />",{class:"list-items "+n,data:{id:i.index,text:t.strip_tags(i.text)}});var a=t("<a />",{}),o=t("<span />",{class:"text",html:t.strip_tags(i.text)}),h=t("<span />",{class:"check-mark",html:"&#10004;"});a.append(o).append(h),n.append(a).on("click",function(){t(this).toggleClass("selected"),s._setSelected(t(this))}),c.append(n)}),this.$list=c},_addEvents:function(e){var s=this;t(e);var i=s.settings,n=i.duration,l=i.easing;t(e).on("click",function(i){i.preventDefault(),t(this);var a=t(e).find("ul");t(e).hasClass("open")?t(i.target).is(a)||t(i.target).is(t("*",a))||("slide"==l?a.slideUp(n,function(){t(e).removeClass("open")}):"fade"==l&&a.fadeOut(n,function(){t(e).removeClass("open")})):"slide"==l?a.slideDown(n,function(){t(e).addClass("open")}):"fade"==l&&a.fadeIn(n,function(){t(e).addClass("open")}),s._hideList()}),t(e).bind("gs.hidden",e,function(e,s){t(this).hasClass("open")?console.log("open"):console.log("not open")})},_styleElement:function(e){var s=this.settings,i=[];i.push(this.basicClass),i.push("button-"+s.selectSize),i.push("button-"+s.selectColor),s.fillButton&&i.push("fill"),i=i.join(" "),s=t("<span />",{class:"button-text",html:s.selectText}),e.addClass(i).html(s)},getData:function(){var t=this.settings.sortByText?this._sortByText():this._sortByKey();return this.settings.data=t,this.settings.data},_sortByText:function(){var e=[];return t.each(this.settings.data,function(t,s){e.push({text:s,index:t})}),e.sort(function(t,e){return t.text>e.text?1:t.text<e.text?-1:0}),e},_sortByKey:function(){var e=[];return t.each(this.settings.data,function(t,s){e.push({text:s,index:t})}),e},_checkSelected:function(){var t=this.$el,e=t.data("list"),s=e.find("li:not(.control)");e=e.find("li.selected:not(.control)"),s.length==e.length?t.find(".select-all-none").text(this.settings.selectNoneText):t.find(".select-all-none").text(this.settings.selectAllText)},getSelectedValues:function(){return this.settings.selectedValues},clearValues:function(){var t=this.$el;t.data("list").find("li.selected").removeClass("selected"),this.settings.selectedValues=[],t.find(".button-text").text(this.settings.selectText)},_selectToggle:function(e){var s=this.$el,i=this.settings,n=s.find(".button-text"),l=(s=s.data("list")).find("li:not(.control)");if(e=t(e),this.settings.selectAllText==e.text()){s.find("li:not(.control)").addClass("selected"),e.text(this.settings.selectNoneText);var a=[],c=[];0<l.length?(l.each(function(e,s){a[e]=t(this).data("id"),c.push(t(this).data("text"))}),l.length<=i.selectedCount?n.text(c.join(", ")):n.text(this.settings.selectedText+" ("+l.length+")")):n.text(this.settings.selectText),this.settings.selectedValues=a,this.settings.onSelect.call(this,this.settings.selectedValues),this._checkSelected()}else this.clearValues(),e.text(this.settings.selectAllText),this.settings.onSelect.call(this,this.settings.selectedValues)},_setSelected:function(e){var s=this.$el;e=this.settings;var i=s.data("list").find("li.selected");s=s.find(".button-text");var n=[],l=[];0<i.length?(i.each(function(e,s){l[e]=t(this).data("id"),n.push(t(this).data("text"))}),i.length<=e.selectedCount?s.text(n.join(", ")):s.text(this.settings.selectedText+" ("+i.length+")")):s.text(this.settings.selectText),this.settings.selectedValues=l,this.settings.onSelect.call(this,this.settings.selectedValues),this._checkSelected()},_hideList:function(){var e=this.$el,i=this.settings,n=i.duration,l=i.easing;t(s).on("click",function(s){e.each(function(){var e=t(this).find(".multi-menu");if(!t(this).is(s.target)&&0===t(this).has(s.target).length&&0===e.has(s.target).length){var i=t(this);"slide"==l?e.slideUp(n,function(){i.removeClass("open")}):"fade"==l&&e.fadeOut(n,function(){i.removeClass("open")})}})})}};t.fn.multi_select=function(e){if(t.isPlainObject(e))return this.each(function(){var s=Object.create(n);s._init(this,e),t(this).data("multi_select",s)});if("string"==typeof e&&0!==e.indexOf("_")){var s=t(this).data("multi_select");return s[e].apply(s,t.makeArray(arguments).slice(1))}},t.fn.multi_select.defaults={selectColor:"red",selectSize:"small",selectText:"Select",selectAllText:"Select all",selectNoneText:"Select none",selectedText:"Selected",selectedCount:3,duration:300,easing:"slide",listMaxHeight:200,selectedIndexes:null,sortByText:!1,fillButton:!1,data:{},buttonWidth:"100%",onSelect:function(){return!0}}}(jQuery,window,document);